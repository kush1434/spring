<!DOCTYPE HTML>
<html xmlns:th="http://www.thymeleaf.org" xmlns:sec="http://www.thymeleaf.org/extras/spring-security">

<!-- 
    Auto-Generated Entity Table Fragment
    
    Usage:
    <th:block th:replace="~{fragments/auto-table :: render(config=${tableConfig}, list=${list})}"></th:block>
    
    Where tableConfig is a TableConfig object with column definitions
-->

<th:block th:fragment="render(config, list)">
    <div class="container" th:attr="data-entity-name=${config.entityName}">
        <h3 th:text="${config.entityDisplayName} + ' Viewer'">Entity Viewer</h3>

        <!-- Auto-generated Column Toggle Buttons -->
        <div class="d-flex flex-wrap mb-3">
            <th:block th:each="col, iterStat : ${config.columns}">
                <button class="btn btn-secondary toggle-column" 
                        th:classappend="${col.visible} ? 'active' : 'inactive'"
                        th:attr="data-column=${iterStat.index}"
                        th:text="${col.label}">Column</button>
            </th:block>
        </div>
        <br>

        <!-- Import/Export Controls (if enabled) -->
        <th:block th:if="${config.hasImportExport}">
            <div class="mb-3">
                <button class="btn btn-success" id="export-all-btn">Export All</button>
                <button class="btn btn-info" id="import-btn">Import JSON</button>
                <input type="file" id="import-file" accept=".json" class="d-none">
            </div>
        </th:block>

        <!-- Auto-generated Table -->
        <div class="row align-items-md-stretch table-responsive">
            <table th:id="${config.tableId}" class="table table-sm table-striped">
                <thead>
                    <tr>
                        <th th:each="col : ${config.columns}" th:text="${col.label}">Column</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="item : ${list}">
                        <!-- Dynamically render each cell based on column config -->
                        <th:block th:each="col : ${config.columns}">
                            <td th:switch="${col.type.name()}">
                                <!-- TEXT: Simple text display -->
                                <span th:case="'TEXT'" th:text="${item[col.field]} ?: ''">Value</span>
                                
                                <!-- LINK: Clickable link -->
                                <a th:case="'LINK'" 
                                   th:href="${col.linkPrefix != null ? col.linkPrefix + item[col.field] : '#'}"
                                   th:text="${item[col.field]}" 
                                   target="_blank">Link</a>
                                
                                <!-- IMAGE: Profile picture (special case for now) -->
                                <div th:case="'IMAGE'" class="profile-picture-container" th:if="${col.field == 'pfp'}">
                                    <a th:attr="id='profile-link-' + ${item.id}, data-person-id=${item.id}" target="_blank">
                                        <img th:attr="id='profile-img-' + ${item.id}" 
                                             th:src="${item.uid != null ? 'https://github.com/' + item.uid + '.png' : 'https://github.com/user-attachments/assets/13dec9b2-21d6-458e-b099-f5f85ae9caf2'}"
                                             alt="Profile Picture"
                                             onerror="this.onerror=null; this.src='https://github.com/user-attachments/assets/13dec9b2-21d6-458e-b099-f5f85ae9caf2';" />
                                    </a>
                                </div>
                                
                                <!-- CHECKBOX: Boolean as checkbox image -->
                                <img th:case="'CHECKBOX'" 
                                     th:src="${item[col.field] ? 'https://github.com/user-attachments/assets/da1c6827-8c47-4ba9-a979-980eb3c685cd' : 'https://github.com/user-attachments/assets/53e808fc-3c01-4cae-b403-73116a71122f'}"
                                     class="custom-checkbox" 
                                     alt="Status" 
                                     style="width: 20px; height: 20px;" />
                                
                                <!-- ACTIONS: Action buttons -->
                                <th:block th:case="'ACTIONS'">
                                    <a th:if="${config.updatePath != null}"
                                       th:href="@{${config.updatePath + '/' + item.id}}" 
                                       class="btn btn-warning btn-sm">Update</a>
                                    <a th:if="${config.updateRolesPath != null}" 
                                       sec:authorize="hasRole('ROLE_ADMIN')"
                                       th:href="@{${config.updateRolesPath + '/' + item.id}}"
                                       class="btn btn-warning btn-sm">Update Roles</a>
                                    <a th:if="${config.deletePath != null}"
                                       th:href="@{${config.deletePath + '/' + item.id}}"
                                       class="btn btn-danger btn-sm">Delete</a>
                                </th:block>
                                
                                <!-- IMPORT_EXPORT: Import/export controls per row -->
                                <th:block th:case="'IMPORT_EXPORT'">
                                    <input type="checkbox" name="export-select" 
                                           class="form-check-input" 
                                           th:attr="export-select-id=${item.id}">
                                    <hr>
                                    <button class="btn btn-info btn-sm" name="export" 
                                            th:attr="export-id=${item.id}">Export</button>
                                    <hr>
                                    <input th:id="${config.entityName + 'SingleFileUpload'}" 
                                           type="file" accept=".json" class="form-control">
                                    <button class="btn btn-info btn-sm" name="import" 
                                            th:attr="import-id=${item.id}">Import</button>
                                </th:block>
                                
                                <!-- CUSTOM: Custom HTML -->
                                <span th:case="'CUSTOM'" th:utext="${col.customFormat}">Custom</span>
                                
                                <!-- Default fallback -->
                                <span th:case="*" th:text="${item[col.field]}">Default</span>
                            </td>
                        </th:block>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Create New Button -->
        <div class="mt-3" th:if="${config.createNewPath != null}">
            <a class="btn btn-primary" th:href="@{${config.createNewPath}}" 
               th:text="${config.createNewLabel != null ? config.createNewLabel : 'Create New ' + config.entityDisplayName}">Create New</a>
        </div>
    </div>
</th:block>

</html>
