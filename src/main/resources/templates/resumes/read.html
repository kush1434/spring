<!DOCTYPE HTML>
<html xmlns:layout="http://www.w3.org/1999/xhtml" xmlns:th="http://www.w3.org/1999/xhtml"
      layout:decorate="~{layouts/base}" lang="en">

<th:block layout:fragment="title" th:remove="tag">Resumes List</th:block>

<th:block layout:fragment="body" th:remove="tag">
    <div sec:authorize="hasRole('ROLE_ADMIN')">
        <!-- AUTO-GENERATED TABLE - ONE LINE RENDERS EVERYTHING! -->
        <th:block th:replace="~{fragments/auto-table :: render(config=${tableConfig}, list=${list})}"></th:block>
    </div>
    <div sec:authorize="!hasRole('ROLE_ADMIN')" class="container">
        <div class="alert alert-danger">Access denied: administrators only.</div>
    </div>
</th:block>

<!-- Overlay for update page -->
<th:block layout:fragment="overlay-body" th:remove="tag">
    <div id="overlay-Container"></div>
</th:block>

<!-- Generic scripts - work with ANY entity! -->
<th:block layout:fragment="script" th:remove="tag">
    <script sec:authorize="hasRole('ROLE_ADMIN')" type="module" th:src="@{/js/entity/entity-extraction.js}"></script>
    <script sec:authorize="hasRole('ROLE_ADMIN')" type="module" th:src="@{/js/entity/entity-importation.js}"></script>
    <script type="text/javascript" th:src="@{/js/read-filter.js}"></script>
    <script type="text/javascript" th:src="@{/js/read-overlay.js}"></script>
    
    <!-- Inline column toggle - guaranteed to work! -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const table = document.querySelector('.table.table-sm.table-striped');
            const toggleButtons = document.querySelectorAll('.toggle-column');
            
            toggleButtons.forEach(button => {
                button.addEventListener('click', function() {
                    const columnIndex = parseInt(this.getAttribute('data-column'));
                    const isActive = this.classList.contains('active');
                    
                    // Toggle all cells in this column
                    const headers = table.querySelectorAll('thead th');
                    const rows = table.querySelectorAll('tbody tr');
                    
                    if (headers[columnIndex]) {
                        headers[columnIndex].style.display = isActive ? 'none' : '';
                    }
                    
                    rows.forEach(row => {
                        const cells = row.querySelectorAll('td');
                        if (cells[columnIndex]) {
                            cells[columnIndex].style.display = isActive ? 'none' : '';
                        }
                    });
                    
                    // Toggle button state
                    this.classList.toggle('active');
                    this.classList.toggle('inactive');
                });
            });
        });
    </script>
</th:block>

</html>
